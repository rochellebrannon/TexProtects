<!DOCTYPE html>

<!--
  Copyright 2011 Google Inc.sdgfdhgffgsdf All Rights Reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#search-string_0').keypress(function (e) {
            if (e.which == 13) {
                changeMap_0();
                return false; //<---- Add this line
            }
        });
        $('#adrsearch').keypress(function (e) {
            if (e.which == 13) {
                zoomto();
                return false; //<---- Add this line
            }
        });


    });
</script>
<style>
	.data
	{
		clear: both;
    float: left;
    display: block;
    position: relative;
	}
	.content
	{
		 margin: auto;
    width: 90%;    
    
	}
    .inputdiv {
        padding-right: 10px;
        float: left;
    }
    
    .btn {}
    
    .inputtext {
        color: rgb(52, 73, 94);
        display: block;
        perspective-origin: 106.25px 21px;
        transform-origin: 106.25px 21px;
        border: 2px solid rgb(189, 195, 199);
        border-radius: 22px;
        font: normal normal normal normal 15px / 22.005px Lato, Helvetica, Arial, sans-serif;
        outline: rgb(52, 73, 94) none 0px;
        padding: 8px 12px;
        transition: border 0.25s linear 0s, color 0.25s linear 0s, background-color 0.25s linear 0s;
        text-align: center;
        background-color: #f0f0f0;
        float: left;
    }
    
    .dashbord {
        margin-left: 5%;
        padding-left: 5%;
    }
    
    .header {
        margin: auto;
        width: 60%;
        padding: 10px;
    }
    
    #mapbox {
        width: 600px;
		float:left;
    }
	#infoWindowDiv{
		float:left;
	}
	
    

    
    .layer-wizard-search-label {
        font-family: sans-serif
    }
    
    ;
</style>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">

    <title>Fusion Tables Layer Example: Dynamic Styling with Legend</title>

    <link href="https://developers.google.com/fusiontables/docs/samples/style/default.css" rel="stylesheet" type="text/css">
    <style type="text/css">
        #legend {
            background-color: #FFF;
            margin: 10px;
            padding: 5px;
            width: 150px;
        }
        
        #legend p {
            font-weight: bold;
            margin-top: 3px;
        }
        
        #legend div {
            clear: both;
        }
        
        .color {
            height: 12px;
            width: 12px;
            margin-right: 3px;
            float: left;
            display: block;
        }
    </style>
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>

    <script type="text/javascript">
        /**
         * Column names mapped to a style rule.
         * @type {Object}
         * @const
         */
        var COLUMN_STYLES = {
            'Rank Order of Means (Overall Risk Ranking)': [{
                'min': 4,
                'max': 326,
                'color': '#ffffb2'
            }, {
                'min': 326,
                'max': 648,
                'color': '#fed976'
            }, {
                'min': 648,
                'max': 970,
                'color': '#feb24c'
            }, {
                'min': 970,
                'max': 1292,
                'color': '#fd8d3c'
            }, {
                'min': 1292,
                'max': 1614,
                'color': '#f03b20'
            }, {
                'min': 1614,
                'max': 1936,
                'color': '#bd0026'
            }],
            'Mean of Rankings (all)': [{
                'min': 88,
                'max': 392,
                'color': '#ffffb2'
            }, {
                'min': 392,
                'max': 696,
                'color': '#fed976'
            }, {
                'min': 696,
                'max': 1000,
                'color': '#feb24c'
            }, {
                'min': 1000,
                'max': 1304,
                'color': '#fd8d3c'
            }, {
                'min': 1304,
                'max': 1608,
                'color': '#f03b20'
            }, {
                'min': 1608,
                'max': 1912,
                'color': '#bd0026'
            }],
            'Poverty < 18': [{
                'min': 85,
                'max': 375,
                'color': '#ffffb2'
            }, {
                'min': 375,
                'max': 667,
                'color': '#fed976'
            }, {
                'min': 667,
                'max': 959,
                'color': '#feb24c'
            }, {
                'min': 959,
                'max': 1251,
                'color': '#fd8d3c'
            }, {
                'min': 1251,
                'max': 1543,
                'color': '#f03b20'
            }, {
                'min': 1543,
                'max': 1835,
                'color': '#bd0026'
            }],
            'Poverty < 5': [{
                'min': 119,
                'max': 392,
                'color': '#ffffb2'
            }, {
                'min': 392,
                'max': 665,
                'color': '#fed976'
            }, {
                'min': 665,
                'max': 938,
                'color': '#feb24c'
            }, {
                'min': 938,
                'max': 1211,
                'color': '#fd8d3c'
            }, {
                'min': 1211,
                'max': 1484,
                'color': '#f03b20'
            }, {
                'min': 1484,
                'max': 1757,
                'color': '#bd0026'
            }],
            'Substance Abuse': [{
                'min': 226,
                'max': 507,
                'color': '#ffffb2'
            }, {
                'min': 507,
                'max': 788,
                'color': '#fed976'
            }, {
                'min': 788,
                'max': 1069,
                'color': '#feb24c'
            }, {
                'min': 1069,
                'max': 1350,
                'color': '#fd8d3c'
            }, {
                'min': 1350,
                'max': 1631,
                'color': '#f03b20'
            }, {
                'min': 1631,
                'max': 1912,
                'color': '#bd0026'
            }]

        };

        function initialize() {
            geocoder = new google.maps.Geocoder();
            map = new google.maps.Map(document.getElementById('map-canvas'), {
                center: new google.maps.LatLng(31.1, -98.5),
                zoom: 6,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });

            layer = new google.maps.FusionTablesLayer({
                suppressInfoWindows: true,
                query: {
                    select: 'geometry',
                    from: '1-saIAOXhsY3Sc6WPvYL5SsJ_U0S94OerpG-Wt6tq'

                }
            });
            layer.setMap(map);

            initSelectmenu();
            for (column in COLUMN_STYLES) {
                break;
            }
            applyStyle(map, layer, column);
            addLegend(map);

            google.maps.event.addDomListener(document.getElementById('selector'),
                'change',
                function () {
                    var selectedColumn = this.value;
                    applyStyle(map, layer, selectedColumn);
                    updateLegend(selectedColumn);
                });
            google.maps.event.addListener(layer, "click", function (e) {
                document.getElementById("infoWindowDiv").innerHTML = e.infoWindowHtml;
				console.log(e.row['Rank Order of Means (Overall Risk Ranking)'].value)
            });
        }
        var zoomToAddress = function (address) {

            geocoder.geocode({
                address: address
            }, function (results, status) {

                if (status == google.maps.GeocoderStatus.OK) {
                    if (address == "county texas") {
                        resetmap();
                    } else {
                        map.setCenter(results[0].geometry.location);
                        map.setZoom(9);
                    }


                    // OPTIONAL: run spatial query to find results within bounds.
                    var sw = map.getBounds().getSouthWest();
                    var ne = map.getBounds().getNorthEast();
                    var where = 'ST_INTERSECTS(' + locationColumn +
                        ', RECTANGLE(LATLNG' + sw + ', LATLNG' + ne + '))';
                    layer.setOptions({
                        query: {
                            select: locationColumn,
                            from: tableId,
                            where: where
                        }
                    });
                } else {
                    window.alert('Address could not be geocoded: ' + status);
                }
            });
        };


        // Initialize the drop-down menu
        function initSelectmenu() {
            var selectMenu = document.getElementById('selector');
            for (column in COLUMN_STYLES) {
                var option = document.createElement('option');
                option.setAttribute('value', column);
                option.innerHTML = column;
                selectMenu.appendChild(option);
            }
        }

        // Apply the style to the layer & generate corresponding legend
        function applyStyle(map, layer, column) {
            var columnStyle = COLUMN_STYLES[column];
            var styles = [];

            for (var i in columnStyle) {
                var style = columnStyle[i];
                styles.push({
                    where: generateWhere(column, style.min, style.max),
                    polygonOptions: {
                        fillColor: style.color,
                        fillOpacity: style.opacity ? style.opacity : 0.8
                    }
                });
            }

            layer.set('styles', styles);
        }

        // Create the where clause
        function generateWhere(columnName, low, high) {
            var whereClause = [];
            whereClause.push("'");
            whereClause.push(columnName);
            whereClause.push("' >= ");
            whereClause.push(low);
            whereClause.push(" AND '");
            whereClause.push(columnName);
            whereClause.push("' < ");
            whereClause.push(high);
            return whereClause.join('');
        }

        // Initialize the legend
        function addLegend(map) {
            var legendWrapper = document.createElement('div');
            legendWrapper.id = 'legendWrapper';
            legendWrapper.index = 1;
            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(
                legendWrapper);
            legendContent(legendWrapper, column);
        }

        // Update the legend content
        function updateLegend(column) {
            var legendWrapper = document.getElementById('legendWrapper');
            var legend = document.getElementById('legend');
            legendWrapper.removeChild(legend);
            legendContent(legendWrapper, column);
        }

        function changeMap_0() {
            var whereClause;
            var searchString = document.getElementById('search-string_0').value.replace(/'/g, "\\'");
            if (searchString != '--Select--') {
                whereClause = "'Corresponding Counties' CONTAINS IGNORING CASE '" + searchString + "'";
                zoomToAddress(document.getElementById('search-string_0').value + "county texas");
            }
            layer.setOptions({
                query: {
                    select: "col7>>1",
                    from: "1-saIAOXhsY3Sc6WPvYL5SsJ_U0S94OerpG-Wt6tq",
                    where: whereClause
                }
            });
        }

        function zoomto() {
            zoomToAddress(document.getElementById('adrsearch').value);
        }

        function resetmap() {

            map.setCenter(new google.maps.LatLng(31.1, -98.5));
            map.setZoom(6);


        }

        // Generate the content for the legend
        function legendContent(legendWrapper, column) {
            var legend = document.createElement('div');
            legend.id = 'legend';

            var title = document.createElement('p');
            title.innerHTML = column;
            legend.appendChild(title);

            var columnStyle = COLUMN_STYLES[column];
            for (var i in columnStyle) {
                var style = columnStyle[i];

                var legendItem = document.createElement('div');

                var color = document.createElement('span');
                color.setAttribute('class', 'color');
                color.style.backgroundColor = style.color;
                legendItem.appendChild(color);

                var minMax = document.createElement('span');
                minMax.innerHTML = style.min + ' - ' + style.max;
                legendItem.appendChild(minMax);

                legend.appendChild(legendItem);
            }

            legendWrapper.appendChild(legend);
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>

<body>
	<div class="content">
		<div class="header_wrapper"> 
        <div class="header">
            <img src="http://texprotects.org/media/images/logos.png">
            <img src="http://texprotects.org/media/images/texprotects.png">
        </div>
    </div>
        <div class="dashbord">

            <div class="widgetText" style="font:bold 32px helvetica;color:rgb(255, 127, 0); text-align:left;; line-height: 36px;;width:100%;height:100%;white-space:pre-wrap; ">Interactive Heat Map</div>
            <div class="widgetText" style="font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 13px; line-height: 19px; font-family: helvetica; color: rgb(136, 136, 136); text-align: left; width: 100%; height: 100%; white-space: pre-wrap; display: block; padding-top: 0px;">TexProtects has analyzed zip code level data from the U.S. Census, Texas Department of Family and Protective Services, and the Texas Department of State Health Services to create a child abuse and neglect risk assessment and ranking through the use of child maltreatment, child fatality, teen pregnancy, substance abuse, and teen birth rates. This interactive tool brings together the 18-month research project so that it can be viewed and analyzed by the public, with the hope of bringing about more data-driven policies and targeted funding.</div>


            <div class="toolbar">
                <label class="layer-wizard-search-label">
                    <div class="inputdiv">
                        <div class="widgetText" style="font-weight: bold; font-style: normal; font-variant: normal; font-stretch: normal; font-size: 18px; font-family: helvetica; color: rgb(78, 75, 75); text-align: left; line-height: 21px; width: 100%; height: 100%; white-space: pre-wrap; padding-top: 0px;">Filter for a county :</div>
                        <input type="text" id="search-string_0" list="counties" class="inputtext" style="width: 162.5px;">
                        <input type="button" onclick="changeMap_0()" value="Go" class="inputtext" class="btn">
                    </div>

                    <div class="inputdiv">
                        <div class="widgetText" style="font-weight: bold; font-style: normal; font-variant: normal; font-stretch: normal; font-size: 18px; font-family: helvetica; color: rgb(78, 75, 75); text-align: left; line-height: 21px; width: 100%; height: 100%; white-space: pre-wrap; padding-top: 0px;">Zoom to location :</div>
                        <input type="text" id="adrsearch" class="inputtext" style="width: 162.5px;">
                        <input type="button" onclick="zoomto()" value="Go" class="inputtext" class="btn">
                    </div>
                    <div class="inputdiv">
                        <div class="widgetText" style="font-weight: bold; font-style: normal; font-variant: normal; font-stretch: normal; font-size: 18px; font-family: helvetica; color: rgb(78, 75, 75); text-align: left; line-height: 21px; width: 100%; height: 100%; white-space: pre-wrap; padding-top: 0px;">Risk Rankings :</div>
                        <select id="selector" class="inputtext"></select>
                    </div>
                    <datalist id="counties"> <option value="Anderson"> <option value="Andrews"> <option value="Angelina"> <option value="Aransas"> <option value="Archer"> <option value="Armstrong"> <option value="Atascosa"> <option value="Austin"> <option value="Bailey"> <option value="Bandera"> <option value="Bastrop"> <option value="Baylor"> <option value="Bee"> <option value="Bell"> <option value="Bexar"> <option value="Blanco"> <option value="Borden"> <option value="Bosque"> <option value="Bowie"> <option value="Brazoria"> <option value="Brazos"> <option value="Brewster"> <option value="Briscoe"> <option value="Brooks"> <option value="Brown"> <option value="Burleson"> <option value="Burnet"> <option value="Caldwell"> <option value="Calhoun"> <option value="Callahan"> <option value="Cameron"> <option value="Camp"> <option value="Carson"> <option value="Cass"> <option value="Castro"> <option value="Chambers"> <option value="Cherokee"> <option value="Childress"> <option value="Clay"> <option value="Cochran"> <option value="Coke"> <option value="Coleman"> <option value="Collin"> <option value="Collingsworth"> <option value="Colorado"> <option value="Comal"> <option value="Comanche"> <option value="Concho"> <option value="Cooke"> <option value="Coryell"> <option value="Cottle"> <option value="Crane"> <option value="Crockett"> <option value="Crosby"> <option value="Culberson"> <option value="Dallam"> <option value="Dallas"> <option value="Dawson"> <option value="DeWitt"> <option value="Deaf Smith"> <option value="Delta"> <option value="Denton"> <option value="Dickens"> <option value="Dimmit"> <option value="Donley"> <option value="Duval"> <option value="Eastland"> <option value="Ector"> <option value="Edwards"> <option value="Ellis"> <option value="El Paso"> <option value="Erath"> <option value="Falls"> <option value="Fannin"> <option value="Fayette"> <option value="Fisher"> <option value="Floyd"> <option value="Foard"> <option value="Fort Bend"> <option value="Franklin"> <option value="Freestone"> <option value="Frio"> <option value="Gaines"> <option value="Galveston"> <option value="Garza"> <option value="Gillespie"> <option value="Glasscock"> <option value="Goliad"> <option value="Gonzales"> <option value="Gray"> <option value="Grayson"> <option value="Gregg"> <option value="Grimes"> <option value="Guadalupe"> <option value="Hale"> <option value="Hall"> <option value="Hamilton"> <option value="Hansford"> <option value="Hardeman"> <option value="Hardin"> <option value="Harris"> <option value="Harrison"> <option value="Hartley"> <option value="Haskell"> <option value="Hays"> <option value="Hemphill"> <option value="Henderson"> <option value="Hidalgo"> <option value="Hill"> <option value="Hockley"> <option value="Hood"> <option value="Hopkins"> <option value="Houston"> <option value="Howard"> <option value="Hudspeth"> <option value="Hunt"> <option value="Hutchinson"> <option value="Irion"> <option value="Jack"> <option value="Jackson"> <option value="Jasper"> <option value="Jeff Davis"> <option value="Jefferson"> <option value="Jim Hogg"> <option value="Jim Wells"> <option value="Johnson"> <option value="Jones"> <option value="Karnes"> <option value="Kaufman"> <option value="Kendall"> <option value="Kenedy"> <option value="Kent"> <option value="Kerr"> <option value="Kimble"> <option value="King"> <option value="Kinney"> <option value="Kleberg"> <option value="Knox"> <option value="La Salle"> <option value="Lamar"> <option value="Lamb"> <option value="Lampasas"> <option value="Lavaca"> <option value="Lee"> <option value="Leon"> <option value="Liberty"> <option value="Limestone"> <option value="Lipscomb"> <option value="Live Oak"> <option value="Llano"> <option value="Loving"> <option value="Lubbock"> <option value="Lynn"> <option value="McCulloch"> <option value="McLennan"> <option value="McMullen"> <option value="Madison"> <option value="Marion"> <option value="Martin"> <option value="Mason"> <option value="Matagorda"> <option value="Maverick"> <option value="Medina"> <option value="Menard"> <option value="Midland"> <option value="Milam"> <option value="Mills"> <option value="Mitchell"> <option value="Montague"> <option value="Montgomery"> <option value="Moore"> <option value="Morris"> <option value="Motley"> <option value="Nacogdoches"> <option value="Navarro"> <option value="Newton"> <option value="Nolan"> <option value="Nueces"> <option value="Ochiltree"> <option value="Oldham"> <option value="Orange"> <option value="Palo Pinto"> <option value="Panola"> <option value="Parker"> <option value="Parmer"> <option value="Pecos"> <option value="Polk"> <option value="Potter"> <option value="Presidio"> <option value="Rains"> <option value="Randall"> <option value="Reagan"> <option value="Real"> <option value="Red River"> <option value="Reeves"> <option value="Refugio"> <option value="Roberts"> <option value="Robertson"> <option value="Rockwall"> <option value="Runnels"> <option value="Rusk"> <option value="Sabine"> <option value="San Augustine"> <option value="San Jacinto"> <option value="San Patricio"> <option value="San Saba"> <option value="Schleicher"> <option value="Scurry"> <option value="Shackelford"> <option value="Shelby"> <option value="Sherman"> <option value="Smith"> <option value="Somervell"> <option value="Starr"> <option value="Stephens"> <option value="Sterling"> <option value="Stonewall"> <option value="Sutton"> <option value="Swisher"> <option value="Tarrant"> <option value="Taylor"> <option value="Terrell"> <option value="Terry"> <option value="Throckmorton"> <option value="Titus"> <option value="Tom Green"> <option value="Travis"> <option value="Trinity"> <option value="Tyler"> <option value="Upshur"> <option value="Upton"> <option value="Uvalde"> <option value="Val Verde"> <option value="Van Zandt"> <option value="Victoria"> <option value="Walker"> <option value="Waller"> <option value="Ward"> <option value="Washington"> <option value="Webb"> <option value="Wharton"> <option value="Wheeler"> <option value="Wichita"> <option value="Wilbarger"> <option value="Willacy"> <option value="Williamson"> <option value="Wilson"> <option value="Winkler"> <option value="Wise"> <option value="Wood"> <option value="Yoakum"> <option value="Young"> <option value="Zapata"> <option value="Zavala"> </datalist>


                </label>
            </div>
                
            <div class="data">
				 <div id="mapbox">
                <div id="map-canvas" style="height:600px;     width: 98%;
    		"></div>
				
            </div>
				<div id="infoWindowDiv" class="dashitem">
					
            </div>
			
			</div>        
<a href="http://goo.gl/forms/hKtTN8oKDe">Survey</a>
			<a href="http://aalluri7.github.io/TexProtects/download.html">Download Data</a>
			
 </div>
</div>
    



</body>

</html>
